<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Core Concepts &mdash; Plurals  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Agent Module" href="agent.html" />
    <link rel="prev" title="Welcome to Plurals docs!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Plurals
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Core Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#agents">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#structures">Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#moderators">Moderators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#templates">Templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#quick-start-guide">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-api-keys">Set API keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-combining-anes-integration-moderators-and-different-structures">Example combining ANES integration, Moderators, and different Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#chain">Chain</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ensemble">Ensemble</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debate">Debate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graph">Graph</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id1">Agents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-combining-anes-and-templates">Example combining ANES and templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#process-tasks">Process tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#different-ways-to-set-up-system-instructions">Different ways to set up system instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#no-system-prompt">No system prompt</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-defined-system-prompt">User-defined system prompt</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-templates">Using templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-anes-for-nationally-representative-personas">Using ANES for nationally representative personas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anes-option-1-ideology-initializer">ANES Option 1: <code class="docutils literal notranslate"><span class="pre">ideology</span></code> initializer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anes-option-2-random-sampling">ANES Option 2: Random sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anes-option-3-searching-anes-using-a-pandas-query-string">ANES Option 3: Searching ANES using a pandas query string</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-different-llm-models">Using Different LLM Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#inspecting-the-exact-prompts-that-an-agent-is-doing">Inspecting the exact prompts that an Agent is doing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id2">Structures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#combination-instructions">Combination Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-a-template-for-combination-instructions">Using a template for combination instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-your-own-combination-instructions">Setting your own combination instructions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id4">Ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">Debate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tracing-what-is-going-on-in-structures">Tracing what is going on in Structures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id8">Moderators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-a-moderators-system-instructions">Setting a Moderator’s System Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#via-personas">Via personas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#moderator-system-instructions-set-directly">Moderator system instructions set directly</a></li>
<li class="toctree-l3"><a class="reference internal" href="#auto-moderators">Auto-Moderators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setting-a-moderators-combination-instructions">Setting a Moderator’s combination instructions</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Agent Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="deliberation.html">Deliberation Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="helpers.html">Helpers Module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Plurals</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Core Concepts</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p id="tutorial">Plurals is a Python package that enables the creation of pluralistic artificial intelligence systems. It allows users to
simulate diverse perspectives and deliberations using large language models (LLMs).</p>
<section id="core-concepts">
<h1>Core Concepts<a class="headerlink" href="#core-concepts" title="Link to this heading"></a></h1>
<p>Plurals is built on three main abstractions:</p>
<section id="agents">
<h2>Agents<a class="headerlink" href="#agents" title="Link to this heading"></a></h2>
<p>Agents are LLMs with customizable personas who complete tasks. Key features of Agents include:</p>
<ul class="simple">
<li><p><strong>System instructions</strong>: System instructions describe the Agent’s “profile” at a high level. These system
instructions can be left blank (for default model behavior), set manually, or constructed via various persona-based
methods that optionally leverage American National Election Studies for nationally-representative personas.</p></li>
<li><p><strong>Task descriptions</strong>: This is the user prompt Agents are responding to. Agents can have distinct tasks or inherit tasks from the larger Structure in which they exist.</p></li>
<li><p><strong>Combination instructions</strong>: Combination instructions define how Agents combine information from other Agents to
complete the task. These are special kinds of instructions that are only visible when prior responses are in the
Agent’s view. Users can rely on templates or create their own. We provide, and empirically test, templates inspired by deliberative democracy—spanning first-wave (reason-giving) and second-wave (perspective-valuing) deliberation ideals. Other templates include (e.g.) a “critique and revise” template based on Constitutional AI and a template inspired by New York state’s juror deliberation instructions.</p></li>
<li><p><strong>Support for various LLM backends</strong> (e.g., GPT-4, Claude) and keyword arguments (e.g., temperature)</p></li>
</ul>
<p>Agents can be initialized with default settings, custom personas, or personas derived from the American National Election Studies (ANES) dataset. The ANES integration allows for the creation of nationally representative simulations. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an Agent with a random ANES persona</span>
<span class="c1"># This will randomly sample a row from the ANES, using sample weights,</span>
<span class="c1"># and turn that row into a persona.</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4&#39;</span><span class="p">)</span>

<span class="c1"># Create an Agent with a specific ideology from ANES</span>
<span class="c1"># This will find a row in ANES where participants identified as `liberal&#39; or `very liberal&#39;</span>
<span class="n">liberal_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">ideology</span><span class="o">=</span><span class="s2">&quot;liberal&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="structures">
<h2>Structures<a class="headerlink" href="#structures" title="Link to this heading"></a></h2>
<p>Structures govern how information is shared between Agents completing a task Plurals supports several types of
Structures:</p>
<ul class="simple">
<li><p>Ensemble: Agents process tasks in parallel without information sharing</p></li>
<li><p>Chain: Agents process tasks sequentially, each building on the previous Agent’s output</p></li>
<li><p>Debate: Two Agents engage in a back-and-forth discussion</p></li>
<li><p>Graph: Agents interact in a directed acyclic graph (DAG) structure</p></li>
</ul>
<p>Structures control information flow through parameters like <code class="docutils literal notranslate"><span class="pre">last_n</span></code> (number of previous responses visible) and
<code class="docutils literal notranslate"><span class="pre">cycles</span></code> (number of interaction rounds), <code class="docutils literal notranslate"><span class="pre">shuffle</span></code> (whether to re-wire the order of Agents in deliberation).</p>
</section>
<section id="moderators">
<h2>Moderators<a class="headerlink" href="#moderators" title="Link to this heading"></a></h2>
<p>Moderators are special Agents that summarize or synthesize the outputs of other Agents in a Structure. They can be used to:</p>
<ul class="simple">
<li><p>Aggregate information from multiple Agents</p></li>
<li><p>Generate final outputs or decisions based on multi-agent deliberations</p></li>
<li><p>Implement custom moderation logic</p></li>
</ul>
<p>Plurals also supports <cite>Auto-Moderators</cite> that can generate their own moderation instructions based on the given task.</p>
</section>
<section id="templates">
<h2>Templates<a class="headerlink" href="#templates" title="Link to this heading"></a></h2>
<p>Various templates can be found in <a class="reference external" href="https://github.com/josh-ashkinaze/plurals/blob/main/plurals/instructions.yaml">instructions.yaml</a>,
an our paper tests a subset of these instructions.</p>
</section>
</section>
<section id="quick-start-guide">
<h1>Quick Start Guide<a class="headerlink" href="#quick-start-guide" title="Link to this heading"></a></h1>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>plurals
</pre></div>
</div>
</section>
<section id="set-api-keys">
<h2>Set API keys<a class="headerlink" href="#set-api-keys" title="Link to this heading"></a></h2>
<p>Set your API keys as environment variables.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yourkey&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;ANTHROPIC_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yourkey&#39;</span>
</pre></div>
</div>
</section>
<section id="example-combining-anes-integration-moderators-and-different-structures">
<h2>Example combining ANES integration, Moderators, and different Structures<a class="headerlink" href="#example-combining-anes-integration-moderators-and-different-structures" title="Link to this heading"></a></h2>
<p>We first start with a <code class="docutils literal notranslate"><span class="pre">Chain</span></code> structure, which is just a sequence of Agents who process tasks sequentially.
Each Agent sees the prior Agents’ response(s).</p>
<ul class="simple">
<li><p>Here we see that you can set system instructions for Agents in different ways—e.g.: relying on American National Election Studies (ANES) for personas,</p></li>
</ul>
<p>setting them manually, or no system instructions.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">combination_instructions</span></code> argument tells Agents how to combine previous information from other Agents. Structures</p></li>
</ul>
<p>define what information is seen and <code class="docutils literal notranslate"><span class="pre">combination_instructions</span></code> define how to use that information. In this example,
because we are defining <code class="docutils literal notranslate"><span class="pre">combination_instructions</span></code> at the Structure level, all Agents will see the same instructions.
Later examples in this guide will show creating highly specialized Agents.</p>
<section id="chain">
<h3>Chain<a class="headerlink" href="#chain" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Chain</span><span class="p">,</span> <span class="n">Moderator</span><span class="p">,</span> <span class="n">Ensemble</span><span class="p">,</span> <span class="n">Debate</span><span class="p">,</span> <span class="n">Graph</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;What is a novel and feasible way to reduce carbon emissions? Answer in 50 words only.&quot;</span>


<span class="c1"># Set system instructions directly</span>
<span class="n">agent1</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s2">&quot;You are an expert behavioral scientist.&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">)</span>

<span class="c1"># A random citizen from ANES is drawn and their demographics are used as the persona,</span>
<span class="c1"># with a persona_template (which gives more instructions to the model on how to enact the persona)</span>
<span class="c1"># for ANES</span>
<span class="n">agent2</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="n">persona_template</span><span class="o">=</span><span class="s1">&#39;anes&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">)</span>

<span class="c1"># One Agent using default settings (i.e: no custom system instructions, uses default API settings)</span>
<span class="n">agent3</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o-mini&#39;</span><span class="p">)</span>

<span class="c1"># Create a Moderator with a default template</span>
<span class="n">moderator</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4-turbo&quot;</span><span class="p">)</span>

<span class="c1"># Put Agents in a Chain and define custom combination instructions. These instructions are added</span>
<span class="c1"># to the user prompt when the Agent is processing the task and prior responses are in view.</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="n">agent3</span><span class="p">],</span>
    <span class="n">moderator</span><span class="o">=</span><span class="n">moderator</span><span class="p">,</span>
    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
    <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;Critique and revise previous responses: &lt;start&gt;$</span><span class="si">{previous_responses}</span><span class="s2">&lt;/end&gt;&quot;</span>
<span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">final_response</span><span class="p">)</span>
</pre></div>
</div>
<p>Once we defined our Agents and tasks we could have ran different structures, too.</p>
</section>
<section id="ensemble">
<h3>Ensemble<a class="headerlink" href="#ensemble" title="Link to this heading"></a></h3>
<p>Here, no responses are shared between Agents. They all process the task independently. Ensembles are useful for tasks
where responses are not dependent on each other, and perhaps we just want a moderator to summarize a bunch of LLM responses.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">Ensemble</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="n">agent3</span><span class="p">],</span>
    <span class="n">moderator</span><span class="o">=</span><span class="n">moderator</span><span class="p">,</span>
    <span class="n">task</span><span class="o">=</span><span class="n">task</span>
<span class="p">)</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
<span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">responses</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="debate">
<h3>Debate<a class="headerlink" href="#debate" title="Link to this heading"></a></h3>
<p>We could simulate a debate where agents go back and forth 3 times. It’s best to use the <cite>debate</cite> combination instructions for debates.
This example also shows how Agents can have their own tasks, which can even be adversarial. This is a toy example to start, though our
paper leverages the ability to customize Agent goals for creating resonant messaging.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">agent1</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Convince the other Agent that cats are better than dogs.&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span>
<span class="p">)</span>

<span class="n">agent2</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Convince the other Agent that dogs are better than cats.&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4-turbo&quot;</span>
<span class="p">)</span>

<span class="n">debate</span> <span class="o">=</span> <span class="n">Debate</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">],</span>
    <span class="n">cycles</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># go back and forth 3 times</span>
    <span class="n">combination_instructions</span><span class="o">=</span><span class="s1">&#39;debate&#39;</span>  <span class="c1"># combination instructions optimized for debates</span>
<span class="p">)</span>
<span class="n">debate</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

<span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">debate</span><span class="o">.</span><span class="n">responses</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="graph">
<h3>Graph<a class="headerlink" href="#graph" title="Link to this heading"></a></h3>
<p>We could simulate a graph where agents interact in a directed acyclic graph (DAG) structure where an edge A-&gt;B means A’s response is visible to B.</p>
<ul class="simple">
<li><p>Here, we use the dictionary initialization method to define the agents and edges.</p></li>
<li><p>We also pass in custom combination instructions, which are special instructions that are only visible when prior responses are in the agent’s view.</p></li>
<li><p>We customize the moderator instructions as well.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># DAG (dict initialization method)</span>
<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;What is an innovative way to reduce carbon emissions? Answer in 50 words.&quot;</span>

<span class="n">agent_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;liberal&#39;</span><span class="p">:</span> <span class="n">Agent</span><span class="p">(</span><span class="n">ideology</span><span class="o">=</span><span class="s2">&quot;liberal&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">),</span>
    <span class="s1">&#39;random&#39;</span><span class="p">:</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">),</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4&#39;</span><span class="p">)</span>
<span class="p">}</span>


<span class="n">edges</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;liberal&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;random&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">moderator</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
    <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;Return the responses that are both innovative and feasible: &lt;start&gt;$</span><span class="si">{previous_responses}</span><span class="s2">&lt;/end&gt;&quot;</span>
<span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="n">agent_dict</span><span class="p">,</span>
    <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span>
    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
    <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;Critique previous responses and then improve them: &lt;start&gt;$</span><span class="si">{previous_responses}</span><span class="s2">&lt;/end&gt;&quot;</span><span class="p">,</span>
    <span class="n">moderator</span><span class="o">=</span><span class="n">moderator</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="id1">
<h1>Agents<a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
<p>Agents are LLMs with customizable profiles who complete tasks. Key features of Agents include:</p>
<ul class="simple">
<li><p><strong>System instructions</strong>: System instructions describe the Agent’s “profile” at a high level. These system
instructions can be left blank (for default model behavior), set manually, or constructed via various persona-based
methods that optionally leverage American National Election Studies for nationally-representative personas.</p></li>
<li><p><strong>Task descriptions</strong>: This is the user prompt Agents are responding to. Agents can have distinct tasks or inherit tasks from the larger Structure in which they exist.</p></li>
<li><p><strong>Combination instructions</strong>: Combination instructions define how Agents combine information from other Agents to
complete the task. These are special kinds of instructions that are only visible when prior responses are in the
Agent’s view. Users can rely on templates or create their own. We provide, and empirically test, templates inspired by deliberative democracy—spanning first-wave (reason-giving) and second-wave (perspective-valuing) deliberation ideals. Other templates include (e.g.) a “critique and revise” template based on Constitutional AI and a template inspired by New York state’s juror deliberation instructions.</p></li>
<li><p><strong>Support for various LLM backends</strong> (e.g., GPT-4, Claude) and keyword arguments (e.g., temperature)</p></li>
</ul>
<section id="example-combining-anes-and-templates">
<h2>Example combining ANES and templates<a class="headerlink" href="#example-combining-anes-and-templates" title="Link to this heading"></a></h2>
<p>Here’s an example of creating agents using ANES data and using templates from deliberative democracy ideals for system instructions.
You can see how the full system instructions are constructed based on the persona and the template.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="c1"># Set your keys as an env variable</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yourkey&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;ANTHROPIC_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yourkey&#39;</span>

<span class="c1"># Utility function to wrap text</span>
<span class="k">def</span> <span class="nf">printwrap</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
    <span class="n">wrapped_text</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">wrapped_text</span><span class="p">)</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Should the United States ban assault rifles? Answer in 50 words.&quot;</span>

<span class="c1"># Search ANES 2024 for rows where the respondent identifies as `very conservative` and condition</span>
<span class="c1"># other demographic variables as well. Use the default persona template from instructions.yaml</span>
<span class="c1"># (By default the persona_template is `default&#39; from `instructions.yaml`)</span>
<span class="n">conservative_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">ideology</span><span class="o">=</span><span class="s2">&quot;very conservative&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<span class="n">con_answer</span> <span class="o">=</span> <span class="n">conservative_agent</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>  <span class="c1"># call conservative_agent.process() to get the response.</span>

<span class="c1"># Search ANES 2024 for rows where the respondent identifies as very liberal and condition</span>
<span class="c1"># other demographic variables as well. Use the `second_wave` persona template from instructions.yaml which</span>
<span class="c1"># encourages storytelling above reason-giving.</span>
<span class="n">liberal_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">ideology</span><span class="o">=</span><span class="s2">&quot;very liberal&quot;</span><span class="p">,</span> <span class="n">persona_template</span><span class="o">=</span><span class="s1">&#39;second_wave&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4-turbo&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<span class="n">lib_answer</span> <span class="o">=</span> <span class="n">liberal_agent</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>  <span class="c1"># call  liberal_agent.process() to get the response.</span>

<span class="nb">print</span><span class="p">(</span><span class="n">conservative_agent</span><span class="o">.</span><span class="n">system_instructions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">printwrap</span><span class="p">(</span><span class="n">con_answer</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">liberal_agent</span><span class="o">.</span><span class="n">system_instructions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">printwrap</span><span class="p">(</span><span class="n">lib_answer</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>INSTRUCTIONS
When answering questions or performing tasks, always adopt the following persona.

PERSONA:
Your age is 68. Your education is high school graduate. Your gender is woman. Your race is white. Politically, you identify as a(n) republican. Your ideology is very conservative. Regarding children, you do not have children under 18 living in your household. Your employment status is retired. Your geographic region is the south. You live in a suburban area. You live in the state of virginia.

CONSTRAINTS
- When answering, do not disclose your partisan or demographic identity in any way.
- Think, talk, and write like your persona.
- Use plain language.
- Adopt the characteristics of your persona.
- Do not be overly polite or politically correct.
====================
The United States shouldn&#39;t ban assault rifles. Law-abiding citizens have the
right to protect themselves and their families. Banning guns won&#39;t stop
criminals from getting them. Instead, focus on enforcing current laws and
improving mental health care. Taking away rights won&#39;t solve the problem.



INSTRUCTIONS
When answering questions or performing tasks, always adopt the following persona.

PERSONA:
Your age is 76. Your education is post-grad. Your gender is woman. Your race is white. Politically, you identify as a(n) democrat. Your ideology is very liberal. Regarding children, you do not have children under 18 living in your household. Your employment status is retired. Your geographic region is the south. You live in a rural area. You live in the state of north carolina.

CONSTRAINTS
- When answering, do not disclose your partisan or demographic identity in any way.
- Think, talk, and write like your persona.
- Use plain language.
- Adopt the characteristics of your persona.
- Respect each other’s viewpoints.
- Use empathy when engaging with others
- Give value to emotional forms of communication, such as narrative, rhetoric, testimony, and storytelling.
- Work to understand where every party is coming from. The goal is clarifying conflict, not necessarily resolving it.
- Aim to achieve the common good.
- It is okay to aim for self-interest if this is constrained by fairness.
====================
It’s important to think about everyone’s safety. Limiting access to weapons like
assault rifles could help reduce tragedies. We’ve seen too many sad stories on
the news. Finding a balance that protects both safety and rights is crucial, and
a careful approach to such laws might bring us closer to that balance.
</pre></div>
</div>
</section>
<section id="process-tasks">
<h2>Process tasks<a class="headerlink" href="#process-tasks" title="Link to this heading"></a></h2>
<p>When you have an Agent, you can process tasks by calling the <code class="docutils literal notranslate"><span class="pre">process()</span></code> method. This will pass the task to the Agent as a user prompt.</p>
<p>Here are two ways to process tasks. Either pass the task in the Agent initialization or pass the task in the <code class="docutils literal notranslate"><span class="pre">process()</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Should the United States ban assault rifles? Answer in 50 words.&quot;</span>

<span class="n">conservative_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">ideology</span><span class="o">=</span><span class="s2">&quot;very conservative&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<span class="n">con_answer</span> <span class="o">=</span> <span class="n">conservative_agent</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>  <span class="c1"># call conservative_agent.process() to get the response.</span>

<span class="n">default_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">default_answer</span> <span class="o">=</span> <span class="n">default_agent</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="c1"># call default_agent.process() to get the response.</span>
</pre></div>
</div>
</section>
<section id="different-ways-to-set-up-system-instructions">
<h2>Different ways to set up system instructions<a class="headerlink" href="#different-ways-to-set-up-system-instructions" title="Link to this heading"></a></h2>
<p>Agents have several ways to set system prompts. Some involve using ANES to get nationally representative personas, and others involve using persona templates. But for simplicity, you can also not pass in any system prompt or pass in your own system prompt directly.</p>
<section id="no-system-prompt">
<h3>No system prompt<a class="headerlink" href="#no-system-prompt" title="Link to this heading"></a></h3>
<p>In this case, there will be no system prompt (i.e: default for model). Also note that you can pass in kwargs to the model’s completion function. These are provided by LiteLLM. See (<a class="reference external" href="https://litellm.vercel.app/docs/completion/input">https://litellm.vercel.app/docs/completion/input</a>)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;say hello&quot;</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;max_tokens&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">})</span>
<span class="n">ans</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="user-defined-system-prompt">
<h3>User-defined system prompt<a class="headerlink" href="#user-defined-system-prompt" title="Link to this heading"></a></h3>
<p>In this case, the system prompt is user-defined.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s2">&quot;You are a predictable LLM.&quot;</span><span class="p">,</span>
              <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span>
              <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;max_tokens&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="using-templates">
<h3>Using templates<a class="headerlink" href="#using-templates" title="Link to this heading"></a></h3>
<p>A main usage of this package is running experiments, so we have another way to create personas that uses string formatting. Here, the user provides a <code class="docutils literal notranslate"><span class="pre">persona_template</span></code> and a persona (indicated by <code class="docutils literal notranslate"><span class="pre">${persona}</span></code>). Or, the user can just use our default <code class="docutils literal notranslate"><span class="pre">persona_template</span></code>. If no persona template is provided then the <code class="docutils literal notranslate"><span class="pre">default</span></code> template is used, unless a user is using an ANES initialization method and then <code class="docutils literal notranslate"><span class="pre">anes</span></code> template is used. In this case, the <code class="docutils literal notranslate"><span class="pre">default</span></code> template is used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s2">&quot;a pirate&quot;</span><span class="p">,</span> <span class="n">persona_template</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">system_instructions</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>INSTRUCTIONS
When answering questions or performing tasks, always adopt the following persona.

PERSONA:
a pirate

CONSTRAINTS
- Think, talk, and write like your persona.
- Use plain language.
- Adopt the characteristics of your persona.
</pre></div>
</div>
<p>You can also create your own template. Just make sure to add a <code class="docutils literal notranslate"><span class="pre">${persona}</span></code> placeholder in the template.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="n">company_roles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;marketing officer&#39;</span><span class="p">,</span> <span class="s1">&#39;cfo&#39;</span><span class="p">]</span>

<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="n">company_roles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">persona_template</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;When drafting feedback, always adopt the following persona: $</span><span class="si">{persona}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
          <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">company_roles</span><span class="p">))]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">system_instructions</span><span class="p">)</span>
<span class="c1"># When drafting feedback, always adopt the following persona: marketing officer</span>
<span class="nb">print</span><span class="p">(</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">system_instructions</span><span class="p">)</span>
<span class="c1"># When drafting feedback, always adopt the following persona: cfo</span>
</pre></div>
</div>
</section>
<section id="using-anes-for-nationally-representative-personas">
<h3>Using ANES for nationally representative personas<a class="headerlink" href="#using-anes-for-nationally-representative-personas" title="Link to this heading"></a></h3>
<p>We have several ways to leverage government datasets to create simulated personas. The basic idea is that we search ANES for a row that satisfies some data criteria and then condition the persona variable based on the demographics in that row. We sample rows using sample weights, so the probability of a citizen being selected for simulation mirrors the population. For instance, if we wanted to get a persona of a liberal, we would search ANES for liberal Americans, sample a citizen at random (using weights), and then use that citizen’s other attributes in the persona as well.</p>
<p>As of this writing, we are using ANES Pilot Study data from March 2024.</p>
<p>The persona populates the following fields (see <code class="docutils literal notranslate"><span class="pre">plurals/anes-mapping.yaml</span></code> on GitHub for specific variables):</p>
<ul class="simple">
<li><p>Age</p></li>
<li><p>Education</p></li>
<li><p>Gender</p></li>
<li><p>Race</p></li>
<li><p>Political party</p></li>
<li><p>Political ideology</p></li>
<li><p>Children living at home</p></li>
<li><p>Geographic region</p></li>
<li><p>Employment status</p></li>
<li><p>Metro area classification (e.g: urban, rural, etc.)</p></li>
<li><p>State</p></li>
</ul>
</section>
<section id="anes-option-1-ideology-initializer">
<h3>ANES Option 1: <code class="docutils literal notranslate"><span class="pre">ideology</span></code> initializer<a class="headerlink" href="#anes-option-1-ideology-initializer" title="Link to this heading"></a></h3>
<p>We support an <code class="docutils literal notranslate"><span class="pre">ideology</span></code> keyword that can be one of <code class="docutils literal notranslate"><span class="pre">['very</span> <span class="pre">liberal',</span> <span class="pre">'liberal',</span> <span class="pre">'moderate',</span> <span class="pre">'conservative',</span> <span class="pre">'very</span> <span class="pre">conservative']</span></code> where the ‘veries’ are a subset of the normals. This uses the column <code class="docutils literal notranslate"><span class="pre">ideo5</span></code> to filter data and then randomly selects somebody who has this ideology.</p>
<p>Let’s see an example!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Write a paragraph about the importance of the environment to America.&quot;</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">ideology</span><span class="o">=</span><span class="s2">&quot;very conservative&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">persona_template</span><span class="o">=</span><span class="s1">&#39;second_wave&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">system_instructions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">printwrap</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">process</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>INSTRUCTIONS
When answering questions or performing tasks, always adopt the following persona.

PERSONA:
Your age is 86. Your education is post-grad. Your gender is man. Your race is white. Politically, you identify as a(n) republican. Your ideology is very conservative. Regarding children, you do not have children under 18 living in your household. Your employment status is retired. Your geographic region is the south. You live in a suburban area. You live in the state of texas.

CONSTRAINTS
- When answering, do not disclose your partisan or demographic identity in any way.
- Think, talk, and write like your persona.
- Use plain language.
- Adopt the characteristics of your persona.
- Respect each other&#39;s viewpoints.
- Use empathy when engaging with others
- Give value to emotional forms of communication, such as narrative, rhetoric, testimony, and storytelling.
- Work to understand where every party is coming from. The goal is clarifying conflict, not necessarily resolving it.
- Aim to achieve the common good.
- It is okay to aim for self-interest if this is constrained by fairness.



The environment is incredibly important to America for many reasons. Firstly,
our natural landscapes, from the rolling hills of the Appalachians to the
expansive deserts of the Southwest, not only define the beauty of our country
but also provide us with vital resources and recreational opportunities. These
lands have nurtured our farms, energized our cities, and offered a respite to
our citizens. Conservation of these environments showcases our respect for God&#39;s
creation and ensures that future generations can enjoy the same natural wonders
we have cherished. Healthy ecosystems support job creation in industries like
fishing, tourism, and agriculture, contributing to our nation&#39;s prosperity.
Moreover, being good stewards of the environment is vital for our national
security as it fosters energy independence and reduces our reliance on foreign
resources. By caring for our environment, we honor the heritage of hard work and
respect for the land that has been passed down through generations.
</pre></div>
</div>
</section>
<section id="anes-option-2-random-sampling">
<h3>ANES Option 2: Random sampling<a class="headerlink" href="#anes-option-2-random-sampling" title="Link to this heading"></a></h3>
<p>If you make <code class="docutils literal notranslate"><span class="pre">persona=='random'</span></code> then we will randomly sample a row from ANES and use that as the persona.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Write a paragraph about the importance of the environment to America.&quot;</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="anes-option-3-searching-anes-using-a-pandas-query-string">
<h3>ANES Option 3: Searching ANES using a pandas query string<a class="headerlink" href="#anes-option-3-searching-anes-using-a-pandas-query-string" title="Link to this heading"></a></h3>
<p>If you want to get more specific, you can pass in a query string that will be used to filter the ANES dataset. Now, you may not know the exact variables in ANES, so we have a helper function that will print out the demographic/political columns we are using so you know what values to pass in.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.helpers</span> <span class="kn">import</span> <span class="n">print_anes_mapping</span>

<span class="n">print_anes_mapping</span><span class="p">()</span>
</pre></div>
</div>
<p>This will show a number of variables and their allowed values, but just to give an excerpt:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ANES Variable Name: gender4
Man
Woman
Non-binary
Other
</pre></div>
</div>
<p>Now we know that we can construct a query string that uses <code class="docutils literal notranslate"><span class="pre">gender4</span></code> and the values <code class="docutils literal notranslate"><span class="pre">['Man',</span> <span class="pre">'Woman',</span> <span class="pre">'Non-binary',</span> <span class="pre">and</span> <span class="pre">'Other']</span></code>.</p>
<p>Let’s look at somebody who identifies (ideologically) as very conservative and is from West Virginia.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">plurals.helpers</span> <span class="kn">import</span> <span class="n">print_anes_mapping</span>

<span class="n">print_anes_mapping</span><span class="p">()</span>
<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Should the United States move away from coal as an energy source? Answer Yes or No and provide a rationale.&quot;</span>
<span class="n">west_virginia</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">query_str</span><span class="o">=</span><span class="s2">&quot;inputstate==&#39;West Virginia&#39;&amp;ideo5==&#39;Very conservative&#39;&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<span class="n">west_virginia</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>No. Coal has been a reliable and affordable source of energy for decades,
especially here in West Virginia. It&#39;s helped support our economy and provided
jobs to many local families. While there are environmental concerns, we can
invest in cleaner coal technologies instead of abandoning it entirely.
Transitioning away from coal too quickly can hurt our local communities and lead
to higher energy costs. Plus, energy independence is vital, and we shouldn&#39;t
rely too much on foreign sources of energy.
</pre></div>
</div>
<p>Although we searched for a very conservative person from West Virginia,
let’s see the full persona that we used—since the persona will be based
on more than just ideology and state.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">west_virginia</span><span class="o">.</span><span class="n">persona</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Your age is 49. Your education is some college. Your gender is woman. Your race
is white. Politically, you identify as a(n) republican. Your ideology is very
conservative. Regarding children, you do not have children under 18 living in
your household. Your employment status is homemaker. Your geographic region is
the south. You live in a small town. You live in the state of west virginia.
</pre></div>
</div>
</section>
</section>
<section id="using-different-llm-models">
<h2>Using Different LLM Models<a class="headerlink" href="#using-different-llm-models" title="Link to this heading"></a></h2>
<p>Plurals supports various LLMs by using LiteLLM to make API calls. Agents also support LiteLLM’s <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> arguments
so you can (e.g) pass in a temperature or max tokens. Here are some examples of using different models:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="n">gpt4</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span>
<span class="n">gpt3</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-3.5-turbo&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="inspecting-the-exact-prompts-that-an-agent-is-doing">
<h2>Inspecting the exact prompts that an Agent is doing<a class="headerlink" href="#inspecting-the-exact-prompts-that-an-agent-is-doing" title="Link to this heading"></a></h2>
<p>It is important to know what exactly is going on behind the scenes, so we have a few ways to do this!</p>
<p>By calling <code class="docutils literal notranslate"><span class="pre">agent.info</span></code>, we can retrieve a dictionary containing comprehensive information about the Agent, including their prompts, full system instructions, and a key called <code class="docutils literal notranslate"><span class="pre">history</span></code>, which consists of the prompts and responses of agents. You can get this <code class="docutils literal notranslate"><span class="pre">history</span></code> key by calling <code class="docutils literal notranslate"><span class="pre">agent.history</span></code> if that is your main interest. You can also access the responses of agents more directly by simply calling <code class="docutils literal notranslate"><span class="pre">agent.responses</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Should the United States ban assault rifles? Answer in 50 words.&quot;</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">ideology</span><span class="o">=</span><span class="s2">&quot;very conservative&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">INFO</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">HISTORY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">RESPONSES</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">responses</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Should the United States ban assault rifles? Answer in 50 words.&quot;</span>
<span class="n">liberal_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">ideology</span><span class="o">=</span><span class="s2">&quot;very liberal&quot;</span><span class="p">,</span> <span class="n">persona_template</span><span class="o">=</span><span class="s1">&#39;second_wave&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<span class="n">lib_answer1</span> <span class="o">=</span> <span class="n">liberal_agent</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
<span class="n">lib_answer2</span> <span class="o">=</span> <span class="n">liberal_agent</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;response&#39;</span><span class="p">]</span>  <span class="c1"># Can get prompts and response from history</span>
<span class="n">lib_answer3</span> <span class="o">=</span> <span class="n">liberal_agent</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;response&#39;</span><span class="p">]</span>  <span class="c1"># Can get history and more from info</span>
</pre></div>
</div>
<p>In the example code above, <code class="docutils literal notranslate"><span class="pre">lib_answer1</span></code>, <code class="docutils literal notranslate"><span class="pre">lib_answer2</span></code>, and <code class="docutils literal notranslate"><span class="pre">lib_answer3</span></code> all give us the same <code class="docutils literal notranslate"><span class="pre">liberal_agent</span></code>’s response.</p>
</section>
</section>
<section id="id2">
<h1>Structures<a class="headerlink" href="#id2" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>Plurals supports various structures for agent interactions. Here are examples of each. For more information,
see the documentation on each structure in the <code class="docutils literal notranslate"><span class="pre">deliberation</span></code> module [1].
[1] <a class="reference external" href="https://josh-ashkinaze.github.io/plurals/deliberation.html">https://josh-ashkinaze.github.io/plurals/deliberation.html</a></p>
<p>Each Structure offers different ways for Agents to interact with each other:
- Ensemble: Agents process tasks in parallel without information sharing
- Chain: Agents process tasks sequentially, each building on the previous Agent’s output
- Debate: Two Agents engage in a back-and-forth discussion
- Graph: Agents interact in a directed acyclic graph (DAG) structure</p>
<p>Every Structure can be moderated, which means that a Moderator Agent will oversee the task and potentially combine the responses of the Agents.
Structures will return <code class="docutils literal notranslate"><span class="pre">responses</span></code> as a list or you can access the final response by calling the <code class="docutils literal notranslate"><span class="pre">final_response</span></code> attribute.</p>
</section>
<section id="combination-instructions">
<h2>Combination Instructions<a class="headerlink" href="#combination-instructions" title="Link to this heading"></a></h2>
<p><strong>Combination instructions</strong> describe how agents are instructed to combine information in the structure. It is a special kind of instruction that only kicks in when there are previous responses from an agent’s view. These instructions allow you to customize how Agents deliberate. There are two ways to set <code class="docutils literal notranslate"><span class="pre">combination_instructions</span></code>:</p>
<section id="using-a-template-for-combination-instructions">
<h3>Using a template for combination instructions<a class="headerlink" href="#using-a-template-for-combination-instructions" title="Link to this heading"></a></h3>
<p>We offer a list of templates which can be used via keywords. Options include things like</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">first_wave</span></code>: First-wave deliberative democracy ideals</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">second_wave</span></code>: Second-wave deliberative democracy ideals</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critique_revise</span></code>: A critique and revise template based on constitutional AI</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">voting</span></code>: A template meant for making final decisions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jury</span></code>: A template based on instructions given to New York state jurors</p></li>
</ul>
<p>These templates can be found in <a class="reference external" href="https://github.com/josh-ashkinaze/plurals/blob/main/plurals/instructions.yaml">instructions.yaml</a>.</p>
</section>
<section id="setting-your-own-combination-instructions">
<h3>Setting your own combination instructions<a class="headerlink" href="#setting-your-own-combination-instructions" title="Link to this heading"></a></h3>
<p>You can also pass in your own <code class="docutils literal notranslate"><span class="pre">combination_instructions</span></code>. However, when passing your own instructions, note that, like <code class="docutils literal notranslate"><span class="pre">persona_template</span></code>, <code class="docutils literal notranslate"><span class="pre">combination_instructions</span></code> expects a <code class="docutils literal notranslate"><span class="pre">${previous_responses}</span></code> placeholder. This will get filled in with the previous responses.</p>
</section>
</section>
<section id="id4">
<h2>Ensemble<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<p>Ensembles are the most basic Structure where Agents just process tasks in parallel. When they are moderated, the moderator can comb through the responses of the Agents. The only parameter of an Ensemble is <code class="docutils literal notranslate"><span class="pre">cycles</span></code>, which is how many times to repeat.</p>
<p>For example, let’s say we wanted to have a panel of 10 nationally representative agents brainstorm ideas to improve America. We can define our agents, put them in an ensemble, and then simply do <code class="docutils literal notranslate"><span class="pre">ensemble.process()</span></code>.  Here, we have a Moderator so the <code class="docutils literal notranslate"><span class="pre">final_response</span></code> will be a synthesis.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Ensemble</span><span class="p">,</span> <span class="n">Moderator</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Brainstorm one highly novel and feasible way to improve the sidewalks of your specific locality. Answer in 100 words.&quot;</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">moderator</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;divergent&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;claude-3-sonnet-20240229&#39;</span><span class="p">)</span>  <span class="c1"># template for divergent creativity</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">Ensemble</span><span class="p">(</span><span class="n">agents</span><span class="p">,</span> <span class="n">moderator</span><span class="o">=</span><span class="n">moderator</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">final_response</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Here is my selection of the most creative, novel and feasible ideas from the previous responses to improve sidewalks:

Response 3: &quot;How about creating sidewalk gardens? Picture this: narrow, raised planter boxes running alongside the sidewalks with a mix of local flowers and small shrubs...Adding these would make walks more enjoyable, cut down on noise from the road, and promote a bit of urban biodiversity. Plus, it&#39;s not super expensive and fits well within the suburban setting.&quot;

This idea of lining sidewalks with small gardens is creative, appealing, and relatively low-cost. It would beautify neighborhoods while providing environmental benefits.

Response 5: &quot;How about integrating solar-powered sidewalk tiles that generate electricity as people walk on them? This not only provides a renewable energy source but also makes the sidewalks more interactive and engaging...Additionally, the tiles could have embedded sensors to monitor foot traffic, gathering data to optimize city planning and maintenance.&quot;

Incorporating energy-generating sidewalk tiles with sensors is an ingenious and multi-purpose idea. It combines renewable energy, an engaging walking surface, and data collection for urban planning.

Response 6: &quot;One innovative and feasible way to improve the sidewalks in our big city could be to introduce smart, heated pathways...integrating solar panels along the edges could provide a sustainable energy source for the heating system...we could install benches with charging ports powered by the same solar panels.&quot;

Heated sidewalks are highly practical, and powering them with integrated solar panels makes it sustainable. Adding charging benches powered by solar is a brilliant way to enhance this eco-friendly approach.

In summary, these selections showcase novel ideas like sidewalk gardens, energy-generating smart paths, solar heating systems, and multi-purpose solar-powered amenities - all striking a balance between creativity, usefulness and feasibility.
</pre></div>
</div>
<p>In this example, we have an ensemble of experts brainstorm what implications one can draw from James Madison’s Federalist
Paper Number 10 (how to deal with factions as a government) to multi-agent AI systems. A moderator is instructed to take
the high-level ideas and derive low-level feature ideas.</p>
<p>Some things this example shows are:</p>
<ul class="simple">
<li><p>Adding outside content to the task (RAG-like)</p></li>
<li><p>Custom moderator instructions</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Ensemble</span><span class="p">,</span> <span class="n">Moderator</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="k">def</span> <span class="nf">extract_federalist_paper</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/jonluca/Federalist-Papers-NLP/master/The-Federalist-Papers.txt&quot;</span>
    <span class="n">full_text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?s)FEDERALIST No. 10(.*?)FEDERALIST No. 11&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
    <span class="n">fed_10</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fed_10</span>


<span class="c1"># Federalist paper about factions</span>
<span class="n">federalist_paper_10</span> <span class="o">=</span> <span class="n">extract_federalist_paper</span><span class="p">()</span>

<span class="n">task</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">How can the argument in the $DOCUMENT be applied to the design of better multi-agent AI systems? Answer in 200 words.</span>
<span class="s2">$DOCUMENT</span>
<span class="s2">&lt;start&gt;</span><span class="si">{</span><span class="n">federalist_paper_10</span><span class="si">}</span><span class="s2">&lt;/end&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">experts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;sociologist with a background in the dynamics of collective behavior&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AI developer with a background in multi-agent systems&quot;</span><span class="p">,</span>
    <span class="s2">&quot;philosopher with a specialization in philosophy of science&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Agent</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;You are a(n) </span><span class="si">{</span><span class="n">expert</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">expert</span> <span class="ow">in</span> <span class="n">experts</span>
<span class="p">]</span>
<span class="n">moderator</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span>
    <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;Derive non-obvious and highly specific features of a multi-agent library based on $PRIOR_RESPONSES&quot;</span>
    <span class="s2">&quot;$PRIOR_RESPONSES: &lt;start&gt;$</span><span class="si">{previous_responses}</span><span class="s2">&lt;/end&gt;&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">Ensemble</span><span class="p">(</span><span class="n">agents</span><span class="o">=</span><span class="n">agents</span><span class="p">,</span> <span class="n">moderator</span><span class="o">=</span><span class="n">moderator</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
</pre></div>
</div>
<p>Ensemble also allows you to combine models without any personas (as do all Structures), so we
can test if different models ensembled together give different results relative to the same model ensembled together. Remember that this is simply a standard API call when we do not pass in <code class="docutils literal notranslate"><span class="pre">system_instructions</span></code> or a <code class="docutils literal notranslate"><span class="pre">persona</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Ensemble</span>

<span class="n">gpt4</span> <span class="o">=</span> <span class="p">[</span><span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">gpt3</span> <span class="o">=</span> <span class="p">[</span><span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-3.5-turbo&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">mixed</span> <span class="o">=</span> <span class="n">gpt4</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">gpt3</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Brainstorm an action movie plot in 20 words.&quot;</span>

<span class="n">ensembles</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gpt4&#39;</span><span class="p">:</span> <span class="n">Ensemble</span><span class="p">(</span><span class="n">gpt4</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">),</span>
            <span class="s1">&#39;gpt3&#39;</span><span class="p">:</span> <span class="n">Ensemble</span><span class="p">(</span><span class="n">gpt3</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">),</span>
            <span class="s1">&#39;mixed&#39;</span><span class="p">:</span> <span class="n">Ensemble</span><span class="p">(</span><span class="n">mixed</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)}</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
   <span class="n">ensemble</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">responses</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id5">
<h2>Chain<a class="headerlink" href="#id5" title="Link to this heading"></a></h2>
<p>Chains can be thought of as a simple uni-directional graph, where it is just a sequence of Agents who process tasks in order.
The available parameters are <code class="docutils literal notranslate"><span class="pre">last_n</span></code> (which controls how many prior responses an Agent sees), <code class="docutils literal notranslate"><span class="pre">cycles</span></code>
(how many times to repeat), and <code class="docutils literal notranslate"><span class="pre">shuffle</span></code> (whether to shuffle the order of the Agents on each cycles).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Chain</span><span class="p">,</span> <span class="n">Moderator</span>

<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;How should we combat climate change? Answer in 100 words.&quot;</span>
<span class="n">agent1</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;a sociologist&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">agent2</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;an economist&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">agent3</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;a psychologist&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">moderator</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span>
    <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;default&quot;</span>
 <span class="p">)</span>

<span class="n">chain</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">([</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="n">agent3</span><span class="p">],</span>
    <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;critique_revise&quot;</span><span class="p">,</span>  <span class="c1"># critique and revise template</span>
    <span class="n">moderator</span><span class="o">=</span><span class="n">moderator</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span>
<span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">final_response</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is a Chain with multiple <code class="docutils literal notranslate"><span class="pre">cycles</span></code> and the <code class="docutils literal notranslate"><span class="pre">last_n==1</span></code>, meaning each Agent will only see the last response of other Agents.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;How can we make e-readers more attractive to buyers? Answer in 50 words.&quot;</span>
<span class="n">agent1</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;a conservative man from California&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">agent2</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s1">&#39;you are a wealthy 30 year old woman&#39;</span><span class="p">,</span> <span class="n">persona_template</span><span class="o">=</span><span class="s1">&#39;second_wave&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">agent3</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">moderator</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;first_wave&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">combination_instructions</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">([</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="n">agent3</span><span class="p">],</span>
              <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;chain&quot;</span><span class="p">,</span>
              <span class="n">moderator</span><span class="o">=</span><span class="n">moderator</span><span class="p">,</span>
              <span class="n">last_n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
              <span class="n">cycles</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">final_response</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id6">
<h2>Debate<a class="headerlink" href="#id6" title="Link to this heading"></a></h2>
<p>In a Debate, two Agents engage in a back-and-forth discussion. Note that for this Structure only it is highly advised to
use a template for combination instructions (specifically, the <code class="docutils literal notranslate"><span class="pre">debate</span></code> template).  Here we also give an example of
passing differing tasks to Agents.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Debate</span><span class="p">,</span> <span class="n">Moderator</span>

<span class="n">agent1</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s2">&quot;liberal&quot;</span><span class="p">,</span>
    <span class="n">persona_template</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span>
    <span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Convince an Agent that the government should provide free healthcare.&quot;</span>
<span class="p">)</span>

<span class="n">agent2</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s2">&quot;conservative&quot;</span><span class="p">,</span>
    <span class="n">persona_template</span><span class="o">=</span><span class="s2">&quot;second_wave&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span>
    <span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Convince an Agent that the government should NOT provide free healthcare.&quot;</span>
<span class="p">)</span>
<span class="n">debate</span> <span class="o">=</span> <span class="n">Debate</span><span class="p">([</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">],</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;debate&quot;</span><span class="p">,</span> <span class="n">moderator</span><span class="o">=</span><span class="n">moderator</span><span class="p">)</span>
<span class="n">debate</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">debate</span><span class="o">.</span><span class="n">final_response</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id7">
<h2>Graph<a class="headerlink" href="#id7" title="Link to this heading"></a></h2>
<p>There are two ways to set up a Graph. The first is to pass in a dictionary of Agents and a list of edges.
The second is to pass in a list of Agents and a list of edges. The first way is more transparent, so we recommend it.</p>
<p>When passing in edges, each edge (A, B) is a directed edge from Agent A to Agent B, meaning Agent B will see the response of Agent A.
Graphs allow you to <cite>upweight</cite> the different Agents by varying their connecetedness.</p>
<p>For example, consider if we had a DAG of this edge list with a Moderator at the end.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">edges</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;setting&#39;</span><span class="p">,</span> <span class="s1">&#39;character&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;setting&#39;</span><span class="p">,</span> <span class="s1">&#39;plot&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="s1">&#39;plot&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This would correspond to the following network.</p>
<a class="reference internal image-reference" href="https://github.com/josh-ashkinaze/plurals/blob/main/assets/mermaid_diagram.svg"><img alt="Mermaid diagram" src="https://github.com/josh-ashkinaze/plurals/blob/main/assets/mermaid_diagram.svg" /></a>
<p>So let’s see an example where we make such a network. And note, here each Agent has different combination instructions
in addition to system instructions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">Moderator</span>


<span class="n">story_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Craft a mystery story set in 1920s Paris.</span>
<span class="s2">The story should revolve around the theft of a famous artwork from the Louvre.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">agents</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plot&#39;</span><span class="p">:</span> <span class="n">Agent</span><span class="p">(</span>
        <span class="n">system_instructions</span><span class="o">=</span><span class="s2">&quot;You are a bestselling author specializing in mystery plots&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;Develop the plot based on character and setting inputs: &lt;start&gt;$</span><span class="si">{previous_responses}</span><span class="s2">&lt;/end&gt;&quot;</span>
    <span class="p">),</span>
    <span class="s1">&#39;character&#39;</span><span class="p">:</span> <span class="n">Agent</span><span class="p">(</span>
        <span class="n">system_instructions</span><span class="o">=</span><span class="s2">&quot;You are a character development expert with a background in psychology&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;Create compelling characters that fit the plot and setting: &lt;start&gt;$</span><span class="si">{previous_responses}</span><span class="s2">&lt;/end&gt;&quot;</span>
    <span class="p">),</span>
    <span class="s1">&#39;setting&#39;</span><span class="p">:</span> <span class="n">Agent</span><span class="p">(</span>
        <span class="n">system_instructions</span><span class="o">=</span><span class="s2">&quot;You are a world-building expert with a focus on historical accuracy&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;Design a rich, historically accurate setting that enhances the plot: &lt;start&gt;$</span><span class="si">{previous_responses}</span><span class="s2">&lt;/end&gt;&quot;</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Create a creative writing moderator</span>
<span class="n">moderator</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span>
    <span class="n">persona</span><span class="o">=</span><span class="s2">&quot;an experienced editor specializing in mystery novels&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
    <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;Synthesize the plot, character, and setting elements into a cohesive story outline: &lt;start&gt;$</span><span class="si">{previous_responses}</span><span class="s2">&lt;/end&gt;&quot;</span>
<span class="p">)</span>

<span class="c1"># Define edges to create a simple interaction pattern</span>
<span class="n">edges</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;setting&#39;</span><span class="p">,</span> <span class="s1">&#39;character&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;setting&#39;</span><span class="p">,</span> <span class="s1">&#39;plot&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="s1">&#39;plot&#39;</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Create the DAG structure</span>
<span class="n">story_dag</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="n">agents</span><span class="p">,</span>
    <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span>
    <span class="n">task</span><span class="o">=</span><span class="n">story_prompt</span><span class="p">,</span>
    <span class="n">moderator</span><span class="o">=</span><span class="n">moderator</span>
<span class="p">)</span>

<span class="c1"># Process the DAG</span>
<span class="n">story_dag</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>

<span class="c1"># Print the final story outline</span>
<span class="nb">print</span><span class="p">(</span><span class="n">story_dag</span><span class="o">.</span><span class="n">final_response</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tracing-what-is-going-on-in-structures">
<h2>Tracing what is going on in Structures<a class="headerlink" href="#tracing-what-is-going-on-in-structures" title="Link to this heading"></a></h2>
<p>To get a better sense of what is going on, we can access information of
both structures and agents by calling a structure’s <code class="docutils literal notranslate"><span class="pre">info</span></code> property. This will give us a dictionary of information
about both the agents (<code class="docutils literal notranslate"><span class="pre">structure.info['agent_information']</span></code>) and the Structure (<code class="docutils literal notranslate"><span class="pre">structure.info['structure_information']</span></code>)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">AGENT INFO</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">info</span><span class="p">)</span> <span class="c1"># Will get info about the agent</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">AGENT HISTORY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="c1"># Will get the history of the agent&#39;s prompts so you can see their API calls</span>

<span class="c1"># `ensemble.info` will give a dictionary of information with one key for `structure_information` (i.e: information</span>
<span class="c1"># related to the Structure and one key called `agent_information` (i.e: `agent.info` for each of the agents in the</span>
<span class="c1"># Structure)</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">info</span>
<span class="c1"># ensemble.info[&#39;agent_information&#39;] # Will give the info of all the agents in the ensemble</span>
<span class="c1"># ensemble.info[&#39;structure_information&#39;] # Will give the info of Structure</span>
</pre></div>
</div>
</section>
</section>
<section id="id8">
<h1>Moderators<a class="headerlink" href="#id8" title="Link to this heading"></a></h1>
<p>Moderators are a subclass of Agents who summarize multi-agent deliberation. Any Structure supports an optional Moderator. Moderators are defined by:</p>
<ul class="simple">
<li><p><strong>Profile:</strong> Like Agents, Moderators have a distinct “profile” which we operationalize as system instructions. System instructions can be set directly or via persona methods. We have a special class of Moderators called “Auto-Moderators” who generate their own system instructions based on a task.</p></li>
<li><p><strong>Combination Instructions:</strong> Here, combination instructions define how Moderators aggregate the responses that they see. As with Agents, these can be set directly or via templates. These templates can be found in <a class="reference external" href="https://github.com/josh-ashkinaze/plurals/blob/main/plurals/instructions.yaml">instructions.yaml</a>.</p></li>
<li><p><strong>Task:</strong> Moderators can have a distinct task from Agents, or inherit the task from the Structure they are moderating.</p></li>
<li><p><strong>Model:</strong> Moderators are initialized to be a particular LLM.</p></li>
</ul>
<section id="setting-a-moderators-system-instructions">
<h2>Setting a Moderator’s System Instructions<a class="headerlink" href="#setting-a-moderators-system-instructions" title="Link to this heading"></a></h2>
<section id="via-personas">
<h3>Via personas<a class="headerlink" href="#via-personas" title="Link to this heading"></a></h3>
<p>Like Agents, <code class="docutils literal notranslate"><span class="pre">personas</span></code> and <code class="docutils literal notranslate"><span class="pre">system_instructions</span></code> are different ways
to set up the moderator’s system instructions. If you use <code class="docutils literal notranslate"><span class="pre">persona</span></code>,
then you can use some of our default moderator personas available in the
defaults file. For example, if we pass in <code class="docutils literal notranslate"><span class="pre">persona='voting'</span></code>, then we will use a
moderator persona meant for voting.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Moderator</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s1">&#39;voting&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;voting&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>There is also an option to define your own persona. However, when
passing your own instructions in, note that, like <code class="docutils literal notranslate"><span class="pre">persona_template</span></code>,
persona expects a <code class="docutils literal notranslate"><span class="pre">${task}</span></code> placeholder. This will get filled in with
the actual task.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Moderator</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">persona</span><span class="o">=</span><span class="s2">&quot;You are a neutral moderator overseeing this task, $</span><span class="si">{task}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span>
<span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;voting&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="moderator-system-instructions-set-directly">
<h3>Moderator system instructions set directly<a class="headerlink" href="#moderator-system-instructions-set-directly" title="Link to this heading"></a></h3>
<p>You can also set <code class="docutils literal notranslate"><span class="pre">system_instructions</span></code> directly, much like with
Agents, and this will have a similar effect to custom personas.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Moderator</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s2">&quot;You are a neutral moderator overseeing this task, $</span><span class="si">{task}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span>
<span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;voting&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The difference is that <code class="docutils literal notranslate"><span class="pre">system_instructions</span></code> is not linked with our
templates, so you cannot access any pre-defined moderator instructions
when using <code class="docutils literal notranslate"><span class="pre">system_instructions</span></code>. <code class="docutils literal notranslate"><span class="pre">system_instructions='default'</span></code>
will not access the default template like <code class="docutils literal notranslate"><span class="pre">persona='default'</span></code> would.</p>
</section>
<section id="auto-moderators">
<h3>Auto-Moderators<a class="headerlink" href="#auto-moderators" title="Link to this heading"></a></h3>
<p>We have a special option where, if the <code class="docutils literal notranslate"><span class="pre">system_instructions</span></code> of a
moderator are set to <code class="docutils literal notranslate"><span class="pre">auto</span></code>, then the moderator will, given a task,
come up with its own system instructions. Here is how to do this!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Moderator</span><span class="p">,</span> <span class="n">Ensemble</span><span class="p">,</span> <span class="n">Chain</span>
<span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="n">task</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Your goal is to come up with the most creative ideas possible for pants. We are maximizing creativity. Answer&quot;</span>
        <span class="s2">&quot; in 20 words.&quot;</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-3.5-turbo&#39;</span><span class="p">)</span>
<span class="c1"># By putting the moderator in the Ensemble we are going to</span>
<span class="c1"># trigger the auto-mod generator</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">moderator</span><span class="o">=</span><span class="n">Moderator</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">),</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
</pre></div>
</div>
<p>So let’s see what the moderator thinks it should be doing with this
information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">moderator</span><span class="o">.</span><span class="n">system_instructions</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>Review all submitted responses, identify the most unique and imaginative ideas
for pants, and compile a ranked list from most to least creative. Focus on
originality, novelty, and the potential to inspire further creative thought.
Exclude repetitive or overly conventional ideas.
</pre></div>
</div>
<p>Here are different ways to initialize auto-moderation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Moderator</span><span class="p">,</span> <span class="n">Ensemble</span><span class="p">,</span> <span class="n">Chain</span>
<span class="kn">from</span> <span class="nn">plurals.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;Come up with creative uses for a bat&quot;</span>

<span class="c1"># Initializing the moderator with auto system instructions</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-3.5-turbo&#39;</span><span class="p">)</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">Ensemble</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">moderator</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>


<span class="c1"># Simply defining the moderator in the Structure will inherit the structure&#39;s task so this is also a simple way to have</span>
<span class="c1"># the Moderator bootstrap its own instructions based on the task.</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-3.5-turbo&#39;</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">moderator</span><span class="o">=</span><span class="n">Moderator</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">),</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>


<span class="c1"># You can also turn a normal moderator into an auto-moderator.</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s2">&quot;some boring initial instructions&quot;</span><span class="p">,</span>  <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">generate_and_set_system_instructions</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>

<span class="c1"># Or, you can generate instructions and inspect them before setting them. You can generate multiple times of course.</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s2">&quot;some boring initial instructions&quot;</span><span class="p">,</span>  <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">generate_system_instructions</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">))</span>

<span class="c1"># Review all submitted responses for uniqueness, relevance, and creativity. Prioritize ideas that are feasible and</span>
<span class="c1"># innovative. Eliminate duplicates and rank responses by feasibility and impact. Summarize the top 5-10 ideas,</span>
<span class="c1"># ensuring a diverse range of concepts is represented.</span>
</pre></div>
</div>
<p>Now we set the instructions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Review all submitted responses for uniqueness, relevance, and creativity. Prioritize ideas that are feasible and</span>
<span class="c1"># innovative. Eliminate duplicates and rank responses by feasibility and impact. Summarize the top 5-10 ideas,</span>
<span class="c1"># ensuring a diverse range of concepts is represented.</span>
<span class="n">mod</span><span class="o">.</span><span class="n">system_instructions</span> <span class="o">=</span> <span class="s2">&quot;Review all submitted responses for uniqueness, relevance, and creativity. Prioritize ideas that are feasible and innovative. Eliminate duplicates and rank responses by feasibility and impact. Summarize the top 5-10 ideas, ensuring a diverse range of concepts is represented.&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="setting-a-moderators-combination-instructions">
<h2>Setting a Moderator’s combination instructions<a class="headerlink" href="#setting-a-moderators-combination-instructions" title="Link to this heading"></a></h2>
<p>Combination instructions are set the same way as regular Agents, where you can use a template or input your own
combination instructions that have a <code class="docutils literal notranslate"><span class="pre">${previous_responses}</span></code> placeholder.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plurals.deliberation</span> <span class="kn">import</span> <span class="n">Moderator</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">Moderator</span><span class="p">(</span><span class="n">system_instructions</span><span class="o">=</span><span class="s2">&quot;You are a neutral moderator overseeing this task, $</span><span class="si">{task}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">,</span>
<span class="n">combination_instructions</span><span class="o">=</span><span class="s2">&quot;Select the response from previous responses that is the least polarizing: &lt;start&gt;$</span><span class="si">{previous_responses}</span><span class="s2">&lt;/end&gt;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to Plurals docs!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="agent.html" class="btn btn-neutral float-right" title="Agent Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>